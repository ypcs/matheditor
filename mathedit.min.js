var MathEditor={_data:{element:null,toolbar:[],},settings:{},addButton:function(e,f,d,a){var c={action:e,icon:d,order:a,title:f};this._data.toolbar.push(c);var b=document.createElement("input");b.type="button";b.className="matheditor-action";b.onclickaction=e;b.matheditor=this.matheditor;b.value=f;b.innerHTML='<i class="todo"></i> '+f;if(typeof b.addEventListener!="undefined"){b.addEventListener("click",function(g){if(typeof g.srcElement.onclickaction!="undefined"){g.srcElement.onclickaction()}else{console.log("No action specified")}return false},false)}else{if(typeof b.attachEvent!="undefined"){b.attachEvent("click",function(g){if(typeof g.srcElement.onclickaction!="undefined"){g.srcElement.onclickaction()}else{console.log("No action specified")}return false})}}this._data.toolbarElement.appendChild(b)},removeButton:function(a){this._data.toolbar.splice(a,1)},guid:function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getToolbar:function(){return this.toolbarElement},insertSelection:function(f,g,d){var c=document.getElementById(f);if(document.selection){c.focus();document.selection.createRange().text=g+document.selection.createRange().text+d}else{if(c.selectionStart||c.selectionStart=="0"){var b=c.selectionStart;var a=c.selectionEnd;c.value=c.value.substring(0,b)+g+c.value.substring(b,a)+d+c.value.substring(a,c.value.length);redraw()}}},enable:function(j){var c=document.getElementById(j);if(typeof(c)=="undefined"){return}console.log('Enable MathEditor for element "'+c.id+'".');c.matheditor=this._clone(this);if(typeof(MathJax)=="undefined"){var l=document.createElement("script");l.src="MathJax/MathJax.js?config=AM_HTMLorMML";var g=document.getElementsByTagName("body")[0];g.appendChild(l)}c.matheditor._data.editor=c;var b=0;var k=c.parentNode.childNodes;for(var d=0;d<k.length;d++){if(k[d]==c){b=d;break}}var n=c.parentNode;var f=document.createElement("div");c.matheditor._data.parent=f;var a="matheditor-"+this.guid();f.id=a;f.className="matheditor";console.log("EditorParent #"+a+".");n.insertBefore(f,k[b]);var m=document.createElement("div");m.className="matheditor-toolbar";c.matheditor._data.toolbarElement=m;f.appendChild(m);f.appendChild(c);var h=document.createElement("div");h.className="matheditor-preview";c.matheditor._data.previewElement=h;f.appendChild(h);if(typeof c.addEventListener!="undefined"){c.addEventListener("keyup",function(i){i.srcElement.matheditor.redraw()},false)}else{if(typeof c.attachEvent!="undefined"){c.attachEvent("onkeyup",function(i){i.srcElement.matheditor.redraw()})}}c.matheditor.addToolbar();c.matheditor.redraw()},addToolbar:function(){this.addButton(function(){},"testi","x",0);this.addButton(function(){},"testi","x",0);this.addButton(function(){},"testi","x",0);this.addButton(function(){},"testi","x",0);this.addButton(function(){},"testi","x",0)},redraw:function(){this._data.previewElement.innerHTML=this._data.editor.value.replace(/\r?\n/g,"<br />");MathJax.Hub.Queue(["Typeset",MathJax.Hub,this._data.previewElement])},selectionInsert:function(e,d){var c=this._data.editor;if(document.selection){c.focus();document.selection.createRange().text=e+document.selection.createRange().text+d}else{if(c.selectionStart||c.selectionStart=="0"){var b=c.selectionStart;var a=c.selectionEnd;c.value=c.value.substring(0,b)+e+c.value.substring(b,a)+d+c.value.substring(a,c.value.length);this.redraw()}}},_clone:function(b){if(null==b||"object"!=typeof b){return b}var c=b.constructor();for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}};