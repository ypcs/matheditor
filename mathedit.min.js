var MathEditor={_data:{element:null,toolbar:[],},settings:{},addButton:function(f,d,e,a){var c={action:e,icon:d,order:a,title:f};this._data.toolbar.push(c);var b=document.createElement("input");b.type="button";b.className="matheditor-action";b.onclickaction=e;b.matheditor=this.matheditor;b.value=f;b.innerHTML='<i class="todo"></i> '+f;if(typeof b.addEventListener!="undefined"){b.addEventListener("click",function(g){if(typeof g.srcElement.onclickaction!="undefined"){g.srcElement.onclickaction()}else{console.log("No action specified")}return false},false)}else{if(typeof b.attachEvent!="undefined"){b.attachEvent("click",function(g){if(typeof g.srcElement.onclickaction!="undefined"){g.srcElement.onclickaction()}else{console.log("No action specified")}return false})}}this._data.toolbarElement.appendChild(b)},removeButton:function(a){this._data.toolbar.splice(a,1)},guid:function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},getToolbar:function(){return this.toolbarElement},insertSelection:function(f,g,d){var c=document.getElementById(f);if(document.selection){c.focus();document.selection.createRange().text=g+document.selection.createRange().text+d}else{if(c.selectionStart||c.selectionStart=="0"){var b=c.selectionStart;var a=c.selectionEnd;c.value=c.value.substring(0,b)+g+c.value.substring(b,a)+d+c.value.substring(a,c.value.length);redraw()}}},enable:function(k){var d=document.getElementById(k);if(typeof(d)=="undefined"){return}console.log('Enable MathEditor for element "'+d.id+'".');d.matheditor=this._clone(this);if(typeof(MathJax)=="undefined"){var m=document.createElement("script");m.src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=AM_HTMLorMML";var h=document.getElementsByTagName("body")[0];h.appendChild(m)}d.matheditor._data.editor=d;var b=0;var l=d.parentNode.childNodes;for(var f=0;f<l.length;f++){if(l[f]==d){b=f;break}}var o=d.parentNode;var g=document.createElement("div");d.matheditor._data.parent=g;var a="matheditor-"+this.guid();g.id=a;g.className="matheditor";console.log("EditorParent #"+a+".");o.insertBefore(g,l[b]);var n=document.createElement("div");n.className="matheditor-toolbar";d.matheditor._data.toolbarElement=n;g.appendChild(n);var c=document.createElement("p");c.className="matheditor-help";c.textContent="HUOM: Kaavat tulee kirjoittaa `-merkkien sisään. Ohjeita syntaksista voit katsoa osoitteesta asciimath.org.";g.appendChild(c);g.appendChild(d);var j=document.createElement("div");j.className="matheditor-preview";d.matheditor._data.previewElement=j;g.appendChild(j);if(typeof d.addEventListener!="undefined"){d.addEventListener("keyup",function(i){i.target.matheditor.redraw()},false)}else{if(typeof d.attachEvent!="undefined"){d.attachEvent("onkeyup",function(i){i.target.matheditor.redraw()})}}d.matheditor.addToolbar();d.matheditor.redraw()},addToolbar:function(){this.addButton("fn","x",function(a){MathEditor.selectionInsert("`","`")},0);this.addButton("alpha","x",function(a){MathEditor.selectionInsert("","alpha")},0);this.addButton("beta","x",function(a){},0);this.addButton("pi","x",function(a){MathEditor.selectionInsert("","pi")},0);this.addButton("dx","x",function(a){MathEditor.selectionInsert("","dx")},0);this.addButton("int","x",function(a){MathEditor.selectionInsert("","int_0^1 f(x) dx")},0);this.addButton("sin","x",function(a){MathEditor.selectionInsert("","sin")},0);this.addButton("cos","x",function(a){MathEditor.selectionInsert("","cos")},0);this.addButton("tan","x",function(a){MathEditor.selectionInsert("","tan")},0);this.addButton("-->","x",function(a){MathEditor.selectionInsert("","rarr")},0);this.addButton("fn","x",function(a){},0)},redraw:function(){this._data.previewElement.innerHTML=this._data.editor.value.replace(/\r?\n/g,"<br />");MathJax.Hub.Queue(["Typeset",MathJax.Hub,this._data.previewElement])},selectionInsert:function(e,d){var c=document.getElementById("editor");if(document.selection){c.focus();document.selection.createRange().text=e+document.selection.createRange().text+d}else{if(c.selectionStart||c.selectionStart=="0"){var b=c.selectionStart;var a=c.selectionEnd;c.value=c.value.substring(0,b)+e+c.value.substring(b,a)+d+c.value.substring(a,c.value.length);this.redraw()}}},_clone:function(b){if(null==b||"object"!=typeof b){return b}var c=b.constructor();for(var a in b){if(b.hasOwnProperty(a)){c[a]=b[a]}}return c}};